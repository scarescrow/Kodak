<!DOCTYPE html>
<html>
<head>
	<title>Kodak</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="css/materialize.min.css">
	<link rel="stylesheet" href="css/style.css"/>
</head>
<body>
	<div class="container">
        <div class="card" id="complete-card">
            <div class="card-image">
                <img id="mainImage"/>
                <span class="card-title" id="mainTitle"></span>
            </div>
            <div class="card-content">
                <p id="mainContent"></p>
            </div>
        </div>
        <div class="fixed-action-btn" onclick="createSlideShowWindow()">
            <a class="btn-floating btn-large red">
                <i class="material-icons">slideshow</i>
            </a>
        </div>
    </div>

    <script type="text/javascript">
        const {firebase} = require('./config');
        const db = firebase.database().ref('posts');
        const remote = require('electron').remote;
        const BrowserWindow = remote.BrowserWindow;
        const $ = require('jquery');
        const ipcRenderer = require('electron').ipcRenderer;
        
        all_posts = null;
        all_keys = [];
        ctr = 0
        new_posts = false;
        imageTimer = null;
        $('#complete-card').hide();

        $(function() {

            db.once("value", function(snap) {
                current_card = all_posts[all_keys[0]];
                updateCard(current_card.src, current_card.title, current_card.desc);
                new_posts = true;
            });

            db.on("child_added", function(snap, prevKey) {
                if (!all_posts)
                    all_posts = {}
                if (new_posts) {

                    added_post = snap.val()
                    all_posts[snap.key] = added_post;
                    all_keys.unshift(snap.key);
                    ctr = -1;
                } else {
                    all_posts[snap.key] = snap.val();
                    all_keys.unshift(snap.key);
                }
            });

            db.on("child_removed", function(snap) {
                delete all_posts[snap.key]
                index = all_keys.indexOf(snap.key);
                all_keys.splice(index, 1);
                ctr = -1;
            });


        });

        function updateCard(src, title, content, callback) {
            $('#complete-card').fadeOut(3000, function() {
                $('#mainImage').attr("src", "");
                $('#mainImage').attr("src", src);
                $('#mainTitle').text(title);
                $('#mainContent').text(content);
                $('#complete-card').fadeIn(3000, function() {
                    callback();
                });
            });
        }

        function createSlideShowWindow() {
            ipcRenderer.send("window:slideShow", {
                'data': all_posts,
                'keys': all_keys
            });
        }

    </script>
</body>
</html>