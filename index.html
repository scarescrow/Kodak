<!DOCTYPE html>
<html>
<head>
	<title>Kodak</title>
	<link rel="stylesheet" href="css/materialize.min.css">
	<link rel="stylesheet" href="css/style.css"/>
</head>
<body onload="load()">
	<div class="container">
        <div class="card">
            <div class="card-image">
                <img id="mainImage" />
                <span class="card-title" id="mainTitle"></span>
            </div>
            <div class="card-content">
                <p id="mainContent"></p>
            </div>
        </div>
    </div>

    <script type="text/javascript">
        const {firebase} = require('./config');
        const db = firebase.database().ref('posts');

        function updateCard(src, title, content) {
            document.getElementById('mainImage').src = src;
            document.getElementById('mainTitle').innerHTML = title;
            document.getElementById('mainContent').innerHTML = content;
        }

        function load() {
            all_posts = null;
            all_keys = [];
            new_posts = false;

            db.once("value", function(snap) {
                current_post = all_posts[all_keys[0]];
                updateCard(current_post.src, current_post.title, current_post.desc);
                new_posts = true;
            });

            db.on("child_added", function(snap, prevKey) {
                if (!all_posts)
                    all_posts = {}
                if (new_posts) {
                    added_post = snap.val()
                    all_posts[snap.key] = added_post;
                    all_keys.unshift(snap.key);
                    updateCard(added_post.src, added_post.title, added_post.desc);
                } else {
                    all_posts[snap.key] = snap.val();
                    all_keys.unshift(snap.key);
                }
            });

            db.on("child_removed", function(snap) {
                delete all_posts[snap.key]
                index = all_keys.indexOf(snap.key);
                all_keys.splice(index, 1);
            });
        }
    </script>
</body>
</html>