<!DOCTYPE html>
<html>
<head>
	<title>Kodak</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<link rel="stylesheet" href="css/materialize.min.css">
	<link rel="stylesheet" href="css/style.css"/>
</head>
<body>
	<div class="container">
        <div class="card" id="complete-card">
            <div class="card-image">
                <img id="mainImage"/>
                <span class="card-title" id="mainTitle"></span>
            </div>
            <div class="card-content">
                <p id="mainContent"></p>
            </div>
        </div>
        <div class="fixed-action-btn">
            <a class="btn-floating btn-large red" onclick="closeSlideShow()">
                <i class="material-icons">clear</i>
            </a>
        </div>
    </div>

    <script type="text/javascript">
        const $ = require('jquery');
        const ipcRenderer = require('electron').ipcRenderer;

        all_posts = null;
        all_keys = [];
        ctr = 0
        $('#complete-card').hide();

        ipcRenderer.on('data:send', function(e, data) {
            all_keys = data.keys;
            all_posts = data.data;
            imageChanger(); 
        });

        function closeSlideShow() {
            ipcRenderer.send("close:slideShow", "close");
        }
        
        function imageChanger() {
            try {
                if (ctr >= all_keys.length || ctr < 0)
                    ctr = 0;
                post = all_posts[all_keys[ctr]];
                updateCard(post.src, post.title, post.desc, function() {
                    ctr += 1;
                    imageTimer = setTimeout(imageChanger, 5000);
                });
            } catch(e) {
                console.log("Error", e);
                console.log("Ctr and length", ctr, all_keys.length);
                console.log("Posts", all_posts);
                console.log("Keys", all_keys);
            }
        }

        function stopTimer() {
            clearTimeout(imageTimer);
        }

        function updateCard(src, title, content, callback) {
            $('#complete-card').fadeOut(3000, function() {
                $('#mainImage').attr("src", "");
                $('#mainImage').attr("src", src);
                $('#mainTitle').text(title);
                $('#mainContent').text(content);
                $('#complete-card').fadeIn(3000, function() {
                    callback();
                });
            });
        }
    </script>
</body>
</html>